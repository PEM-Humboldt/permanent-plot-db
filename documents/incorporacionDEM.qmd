---
title: "Incorporating the Digital Elevation Model for Colombia"
author: "Marius Bottin"
lang: es
format: 
  gfm:
    df-print: kable
knitr: 
  opts_chunk: 
    fig.path: "./Fig/Incor_DEM"
---

Julian Torres gave me the 2014 version (from IGAC) of the SRTM with a 1 arc-grade resolution.

```{r}
DIR_DATA <- "/home/marius/Travail/Data/DEM/DEM 30_COMPLETO/"
dir(DIR_DATA)
require(sf)
require(rpostgis)
require(terra)
dem<-rast(paste(DIR_DATA,"dem_colombia_magna_30m.img",sep="/"))
#crs(dem)<-crs("epsg:4170")
```

## Connect to the database

```{r}
pp_bst <- RPostgres::dbConnect(RPostgres::Postgres(), dbname = "pp_bst_col")
```

## Managing the reference systems

```{r}
(sridDB<-RPostgres::dbGetQuery(pp_bst,"SELECT auth_name||':'||auth_srid srs FROM geometry_columns LEFT JOIN spatial_ref_sys USING(srid) WHERE f_table_schema='main' GROUP BY auth_name,auth_srid ORDER BY count(*) DESC LIMIT 1")$srs)
dem<-project(dem,crs(sridDB))
```

## Creating the shemas

```{r}
schemas<-RPostgres::dbGetQuery(pp_bst,"SELECT schema_name FROM information_schema.schemata")$schema_name
if(!"tmp" %in% schemas)
{RPostgres::dbExecute(pp_bst,"CREATE schema tmp")}
if(!"spat" %in% schemas)
{RPostgres::dbExecute(pp_bst,"CREATE schema spat")}
```

## Importing the DEM

```{r}
pgWriteRast(pp_bst,c("spat","dem"),raster=dem,overwrite=T)
```

## Shutting down light...

```{r}
RPostgres::dbDisconnect(pp_bst)
```


